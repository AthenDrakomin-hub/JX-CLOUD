# 生产环境部署检查清单

## 1. 环境配置

### 1.1 环境变量配置
- [ ] `VITE_SUPABASE_URL` - Supabase 项目 URL
- [ ] `VITE_SUPABASE_ANON_KEY` - Supabase 匿名密钥
- [ ] `GEMINI_API_KEY` - (可选) Gemini API 密钥 (用于 AI 功能)

### 1.2 部署平台配置 (Vercel)
- [ ] 在 Vercel 项目设置中配置正确的环境变量
- [ ] 设置构建命令为 `npm run build`
- [ ] 设置输出目录为 `dist`
- [ ] 确认域名配置正确

## 2. 数据库配置

### 2.1 Supabase 数据库初始化
- [ ] 在 Supabase SQL 编辑器中运行完整的数据库初始化脚本
- [ ] 确认所有表已正确创建:
  - [ ] `users` - 用户/员工表
  - [ ] `rooms` - 房间/桌位表
  - [ ] `dishes` - 菜品菜单表
  - [ ] `orders` - 订单流水表
  - [ ] `expenses` - 运营支出表
  - [ ] `payment_configs` - 支付配置表
  - [ ] `security_logs` - 安全日志表

### 2.2 数据库索引配置
- [ ] 确认已创建优化查询的索引:
  - [ ] `idx_orders_status_created` - 订单状态和创建时间索引
  - [ ] `idx_orders_room` - 订单房间索引
  - [ ] `idx_dishes_category_available` - 菜品分类可用性索引
  - [ ] `idx_dishes_recommended` - 推荐菜品索引

### 2.3 行级安全策略 (RLS)
- [ ] 确认已为所有表启用 RLS
- [ ] 验证安全策略正确配置:
  - [ ] 菜品表 - 访客只读可用菜品
  - [ ] 房间表 - 访客只读房间状态
  - [ ] 订单表 - 访客可创建订单，员工可管理订单
  - [ ] 安全日志表 - 管理员完全访问，员工只读自己的日志

### 2.4 Realtime 配置
- [ ] 在 Supabase Dashboard 的 **Database -> Replication** 中，确保 `orders` 表已启用 **Realtime** 选项

## 3. 安全配置

### 3.1 身份验证配置
- [ ] 配置 Supabase Auth 提供者 (如果需要)
- [ ] 设置密码策略 (最小长度、复杂度等)
- [ ] 配置邮件模板 (如果需要)

### 3.2 安全审计
- [ ] 确认所有敏感操作都会通过 `logAction` 函数自动记录在 `security_logs` 表中
- [ ] 验证高风险操作的审计日志记录:
  - [ ] 员工资料修改
  - [ ] 菜单项目删除
  - [ ] 订单撤销
  - [ ] 系统设置更改

### 3.3 输入验证
- [ ] 验证所有 API 端点都有适当的数据验证
- [ ] 确认已实现防止 XSS 攻击的输入清理
- [ ] 测试数据验证函数 (用户、订单、菜品等)

## 4. 性能优化

### 4.1 前端优化
- [ ] 确认生产构建已启用代码分割
- [ ] 验证资源已正确压缩 (CSS, JS, 图片)
- [ ] 测试懒加载组件是否正常工作

### 4.2 数据库性能
- [ ] 确认所有关键查询都有适当的索引
- [ ] 测试高并发场景下的数据库性能
- [ ] 验证缓存策略 (如果适用)

## 5. 监控和日志

### 5.1 应用监控
- [ ] 设置错误监控 (例如 Sentry)
- [ ] 配置性能监控
- [ ] 验证所有错误都正确记录和处理

### 5.2 安全日志
- [ ] 验证安全日志记录功能
- [ ] 测试日志查询和过滤功能
- [ ] 确认日志保留策略

## 6. 备份和恢复

### 6.1 数据备份
- [ ] 配置 Supabase 数据库自动备份
- [ ] 验证备份恢复流程
- [ ] 设置备份保留策略

### 6.2 灾难恢复
- [ ] 制定灾难恢复计划
- [ ] 测试恢复流程
- [ ] 准备应急联系人列表

## 7. 合规性检查

### 7.1 数据隐私
- [ ] 确认符合 GDPR 等数据隐私法规
- [ ] 验证不收集不必要的个人身份信息 (PII)
- [ ] 检查数据保留和删除策略

### 7.2 法律合规
- [ ] 确认隐私政策和免责声明已正确显示
- [ ] 验证知识产权声明
- [ ] 检查服务条款

## 8. 测试验证

### 8.1 功能测试
- [ ] 完整的端到端测试
- [ ] 用户权限和角色测试
- [ ] 支付流程测试
- [ ] 订单处理流程测试

### 8.2 安全测试
- [ ] 渗透测试
- [ ] 权限提升测试
- [ ] 数据泄露测试

### 8.3 负载测试
- [ ] 高并发订单处理测试
- [ ] 压力测试
- [ ] 性能基准测试

## 9. 文档和培训

### 9.1 操作文档
- [ ] 系统管理员手册
- [ ] 用户操作手册
- [ ] 故障排除指南
- [ ] 应急响应程序

### 9.2 培训材料
- [ ] 员工培训材料
- [ ] 操作视频教程
- [ ] 常见问题解答

## 10. 上线准备

### 10.1 最终检查
- [ ] 在预发布环境中进行全面测试
- [ ] 确认所有功能按预期工作
- [ ] 验证性能指标满足要求

### 10.2 发布计划
- [ ] 制定发布时间表
- [ ] 准备回滚计划
- [ ] 通知相关利益方
- [ ] 准备上线后监控

### 10.3 后续维护
- [ ] 设置定期安全更新
- [ ] 配置监控警报
- [ ] 制定维护窗口
- [ ] 准备定期备份验证

---

**注意**: 在生产环境部署前，必须完成所有检查项。如有任何未完成的项目，不得上线。