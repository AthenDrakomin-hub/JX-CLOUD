# 江西云厨API网关 - 部署脚本
# 设置环境变量并部署到Supabase Edge Functions

# 设置环境变量
$env:SUPABASE_ACCESS_TOKEN="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpsYmVtb3BjZ2pvaHJueXlpd3ZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU4Njg5MzksImV4cCI6MjA4MTQ0NDkzOX0.JL3nNxW7s5x4D1Bz7t8Kq2p5v4Y6j3n2W9x8z7R4t1Y"
$env:SUPABASE_URL="https://zlbemopcgjohrnyyiwvs.supabase.co"
$env:SUPABASE_SERVICE_ROLE_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpsYmVtb3BjZ2pvaHJueXlpd3ZzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NTg2ODkzOSwiZXhwIjoyMDgxNDQ0OTM5fQ.eEiAhCFcRuTuxcoGpiX5U3s-hUKx-Iey6w958MraZug"

Write-Host "正在部署江西云厨API网关到Supabase Edge Functions..."

# 验证函数文件存在
if (Test-Path "supabase/functions/api/index.ts") {
    Write-Host "✅ API网关文件存在"
} else {
    Write-Host "❌ API网关文件不存在"
    exit 1
}

# 验证import_map.json文件存在
if (Test-Path "supabase/functions/import_map.json") {
    Write-Host "✅ Import map文件存在"
} else {
    Write-Host "❌ Import map文件不存在"
    exit 1
}

Write-Host "准备部署..."
Write-Host "Project Ref: zlbemopcgjohrnyyiwvs"
Write-Host "Function Name: api"

# 显示部署命令（实际部署需要有效的访问令牌）
Write-Host "npx supabase functions deploy api --project-ref zlbemopcgjohrnyyiwvs"
Write-Host ""
Write-Host "注意：要完成部署，您需要有效的Supabase访问令牌。"
Write-Host "请访问 https://app.supabase.com/account/tokens 创建访问令牌，"
Write-Host "然后运行: supabase login --token 'your_token_here'"